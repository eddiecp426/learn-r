---
title: "Heatmaps in R"
author: "Jeff Oliver"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: html_document
---

A worked example of making heatmaps in R with the `ggplot` package, as well as some data wrangling to easily format the data needed for the plot.

#### Learning objectives
1. Manipulate data into a 'tidy' format
2. Visualize data in a heatmap
3. Become familiar with `ggplot` syntax for customizing plots

## Heatmaps & data wrangling
Heatmaps are a great way of displaying three-dimensional data in only two dimensions. But how can we easily translate tabular data into a format for heatmap plotting? By taking advantage of "data munging" and graphics packages, heatmaps are relatively easy to produce in R. 

***

## Getting started
+ Set up project with data & output folders
+ Describe the data (source et al) 
[doi: 10.1016/j.gdata.2016.11.004](https://doi.org/10.1016/j.gdata.2016.11.004)
[Chrysotile asbestos](https://en.wikipedia.org/wiki/Chrysotile) mine
+ Download mine data (get tinyurl)
+ Quick peek at data

***

## [TOPIC ONE]
Need to have data set with an id column and another column we want to preserve, but not the id column

***

## [TOPIC TWO]

```{r}
library("tidyr")
library("ggplot2")
mine.data <- read.csv(file = "data/mine-microbe-class-data.csv")

mine.long <- gather(data = mine.data, key = Class, value = Abundance, -c(1:3))
# Alternative means of skipping columns by name
# mine.long <- gather(data = mine.data, key = Class, value = Abundance, -Site, -Depth, -Sample.name)

mine.long$Sqrt.abundance <- sqrt(mine.long$Abundance)

mine.heatmap <- ggplot(data = mine.long, aes(x = Sample.name,
                                             y = Class,
                                             fill = Sqrt.abundance)) +
  geom_tile() +
  scale_fill_gradient(name = "Sqrt(Abundance)",
                      low = "#FFFFFF",
                      high = "#012345") +
  scale_y_discrete(limits = rev(levels(as.factor(mine.long$Class)))) +
  ggtitle(label = "Microbe Class Diversity") + 
  theme_bw() +
  xlab(label = "Depth(m)") +
  facet_grid(~ Depth, switch = "x", scales = "free_x", space = "free_x") + 
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_blank(),
        axis.text.y = element_text(size = 8),
        strip.background = element_rect(fill = "#EEEEEE", color = "#FFFFFF"),
        panel.grid = element_blank(),
        # panel.border = element_rect(color = "#333333"),
        # panel.border = element_blank(),
        # panel.spacing.x = unit(x = -0.5, units = "lines"),
        strip.placement = "outside")

mine.heatmap

```

***

## Additional resources

+ [resource one](url-one)
+ [resource two](url-two)

***

<a href="index.html">Back to learn-r main page</a>
  
Questions?  e-mail me at <a href="mailto:jcoliver@email.arizona.edu">jcoliver@email.arizona.edu</a>.