---
title: "Heatmaps in R"
author: "Jeff Oliver"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: html_document
---

A worked example of making heatmaps in R with the `ggplot` package, as well as some data wrangling to easily format the data needed for the plot.

#### Learning objectives
1. Manipulate data into a 'tidy' format
2. Visualize data in a heatmap
3. Become familiar with `ggplot` syntax for customizing plots

## Heatmaps & data wrangling
Heatmaps are a great way of displaying three-dimensional data in only two dimensions. But how can we easily translate tabular data into a format for heatmap plotting? By taking advantage of "data munging" and graphics packages, heatmaps are relatively easy to produce in R. 

***

## Getting started
Start by creating a new project in RStudio and creating two folders we'll use to organize our efforts. The two folders should be `data` and `output` and will store...data and output.
```{r eval = FALSE}
dir.create("data")
dir.create("output")
```

For this lesson we will use data from a diversity survey of microbial life in a [chrysotile asbestos](https://en.wikipedia.org/wiki/Chrysotile) mine. Driscoll and colleagues [doi: 10.1016/j.gdata.2016.11.004](https://doi.org/10.1016/j.gdata.2016.11.004) used next generation sequencing to identify and categorize bacterial diversity in a flooded pit of the abandoned mine. The data are normalized read counts for microbes found at the sites. A subset of the data can be downloaded from [https://tinyurl.com/mine-data-csv](https://tinyurl.com/mine-data-csv) (which itself redirects to [https://jcoliver.github.io/learn-r/data/mine-microbe-class-data.csv](https://jcoliver.github.io/learn-r/data/mine-microbe-class-data.csv)). You can download this file to your computer with the `download.file` function:
```{r eval = FALSE}
download.file(url = https://tinyurl.com/mine-data-csv, 
              destfile = "data/mine-microbe-class-data.csv")
```
This downloads the data and saves it in the `data` directory as `mine-microbe-class-data.csv`.  

***

## [TOPIC ONE]
+ Quick peek at the data
+ Describe the type of data we need (effectively a data frame with an x, y, and z column)
Need to have data set with an id column and another column we want to preserve, but not the id column

***

## [TOPIC TWO]

```{r}
library("tidyr")
library("ggplot2")
mine.data <- read.csv(file = "data/mine-microbe-class-data.csv")

mine.long <- gather(data = mine.data, key = Class, value = Abundance, -c(1:3))
# Alternative means of skipping columns by name
# mine.long <- gather(data = mine.data, key = Class, value = Abundance, -Site, -Depth, -Sample.name)

mine.long$Sqrt.abundance <- sqrt(mine.long$Abundance)

mine.heatmap <- ggplot(data = mine.long, aes(x = Sample.name,
                                             y = Class,
                                             fill = Sqrt.abundance)) +
  geom_tile() +
  scale_fill_gradient(name = "Sqrt(Abundance)",
                      low = "#FFFFFF",
                      high = "#012345") +
  scale_y_discrete(limits = rev(levels(as.factor(mine.long$Class)))) +
  ggtitle(label = "Microbe Class Diversity") + 
  theme_bw() +
  xlab(label = "Depth(m)") +
  facet_grid(~ Depth, switch = "x", scales = "free_x", space = "free_x") + 
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_blank(),
        axis.text.y = element_text(size = 8),
        strip.background = element_rect(fill = "#EEEEEE", color = "#FFFFFF"),
        panel.grid = element_blank(),
        # panel.border = element_rect(color = "#333333"),
        # panel.border = element_blank(),
        # panel.spacing.x = unit(x = -0.5, units = "lines"),
        strip.placement = "outside")

mine.heatmap

```

***

## Additional resources

+ [resource one](url-one)
+ [resource two](url-two)

***

<a href="index.html">Back to learn-r main page</a>
  
Questions?  e-mail me at <a href="mailto:jcoliver@email.arizona.edu">jcoliver@email.arizona.edu</a>.