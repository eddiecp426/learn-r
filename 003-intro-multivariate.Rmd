---
title: "Introduction to Multivariate Statistics in R"
author: "Jeff Oliver"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: 
  html_document:
    css: stylesheets/markdown-styles.css
---

REDO with Otter data?
[Divergent Skull Morphology Supports Two Trophic Specializations in Otters (Lutrinae)](https://dx.doi.org/10.1371%2Fjournal.pone.0143236)

##See: 

###PCA:

+ http://www.statmethods.net/advstats/factor.html
+ https://www.r-bloggers.com/computing-and-visualizing-pca-in-r/
+ [Why PCA? (or "how to explain PCA to your grandmother")](http://stats.stackexchange.com/questions/2691/making-sense-of-principal-component-analysis-eigenvectors-eigenvalues)
+ [Principal Components Regression](https://www.r-bloggers.com/performing-principal-components-regression-pcr-in-r/)

###Clustering, K-means:

+ https://www.r-bloggers.com/k-means-clustering-in-r/
+ http://www.statmethods.net/advstats/cluster.html
+ https://stat.ethz.ch/R-manual/R-devel/library/stats/html/kmeans.html
+ http://stackoverflow.com/questions/15376075/cluster-analysis-in-r-determine-the-optimal-number-of-clusters
+ [Wikipedia entry for the various ways of determining the optimal number of clusters](https://en.wikipedia.org/wiki/Determining_the_number_of_clusters_in_a_data_set)
+ [Programmatically identifying the "elbow"](http://stackoverflow.com/questions/2018178/finding-the-best-trade-off-point-on-a-curve)

###Ignore these:

+ http://www.statmethods.net/stats/regression.html _ignore_
+ https://www.r-bloggers.com/r-tutorial-series-anova-tables/ _ignore_

An introduction to using the R statistics package and the RStudio interface for multivariate statistics.

####Learning objectives
1. Prepare data in spreadsheet program (e.g. Excel, LibreOffice Calc) for export to R
2. Read data from files into R
3. Run Principal Components Analysis (PCA) and graphically display results
4. Run K-means clustering analysis
5. Run DFA?

##Setup
First we need to setup our development environment. We need to create two folders: 'data' will store the data we will be analyzing, and 'output' will store the results of our analyses.
```{r, eval = FALSE}
dir.create(path = "data")
dir.create(path = "output")
```

##Preparing data in external source

***
+ Download data file from https://jcoliver.github.io/learn-r/data/iris.xlsx
+ Open in spreadsheet program
+ Export / Save As... a CSV file

##Reading data into R
```{r}
otter <- read.csv(file = "data/otter-mandible-data.csv", header = TRUE)
otter <- na.omit(otter)
```
***

##PCA

+ Why pca?
+ Do pca
+ point out
  + summary for the proportion of variance)
  + loadings for what points along an axis actually mean, e.g. high PC 1 score -> relatively smaller sepal width
+ do call to biplot (ugly)
+ do plot from fit$scores
  + make plot nicer

```{r}
pca.fit <- princomp(x = otter[, -1])
species <- unique(otter$species)
legend.cols <- c("black", "darkred", "cadetblue", "forestgreen")
pt.cols <- rep(x = legend.cols[1], length = nrow(otter))
pt.cols[otter$species == species[2]] <- legend.cols[2]
pt.cols[otter$species == species[3]] <- legend.cols[3]
pt.cols[otter$species == species[4]] <- legend.cols[4]
plot(x = pca.fit$scores[, 1],
     y = pca.fit$scores[, 2],
     xlab = "PC 1",
     ylab = "PC 2",
     pch = 19,
     col = pt.cols)
legend("topright", legend = species, pch = 19, col = legend.cols, cex = 0.6)

boxplot(formula = jaw.length ~ species, data = otter)
boxplot(formula = mandibular.ramus.height ~ species, data = otter)
```

### Compare to `prcomp`

```{r}
pca.fit <- princomp(x = otter[, -1])
species <- unique(otter$species)
legend.cols <- c("black", "darkred", "cadetblue", "forestgreen")
pt.cols <- rep(x = legend.cols[1], length = nrow(otter))
pt.cols[otter$species == species[2]] <- legend.cols[2]
pt.cols[otter$species == species[3]] <- legend.cols[3]
pt.cols[otter$species == species[4]] <- legend.cols[4]
plot(x = pca.fit$scores[, 1],
     y = pca.fit$scores[, 2],
     xlab = "PC 1",
     ylab = "PC 2",
     pch = 19,
     col = pt.cols)
legend("topright", legend = species, pch = 19, col = legend.cols, cex = 0.6)

boxplot(formula = jaw.length ~ species, data = otter)
boxplot(formula = mandibular.ramus.height ~ species, data = otter)
```


+ Standardize variables, mean = 0, variance = 1
+ eigenvalues are variance by each component
  + Get % variance for i^th^ component via eig~i~/n, where n is the total number of components (total number of variables)
+ Look at loadings to explain variation in data

***

##Clustering with K-means

```{r}
# Scale data & drop species column
otter.scaled <- scale(x = otter[, -1])
wss <- numeric(10)
for (i in 1:10) {
  kmeans.fit <- kmeans(x = otter.scaled, centers = i, nstart = 10)
  wss[i] <- kmeans.fit$tot.withinss
}
plot(x = c(1:length(wss)), y = wss, xlab = "Number of clusters, K", ylab = "Total within SS", type = "b")

# Percentage of variance explained is the ratio of the between-group variance to the total 
# variance, also known as an F-test. A slight variation of this method plots the curvature 
# of the within group variance. https://en.wikipedia.org/wiki/Determining_the_number_of_clusters_in_a_data_set
# 

```

Abstracting the number of clusters to analyze
```{r}
```

Apply "Elbow" method based on percentage of variance explained
```{r}
# Advanced
```

See how clustering aligned with species
```{r}
# Run kmeans again for K = 4, to get clustering info
otter.k.4 <- kmeans(x = otter.scaled, centers = 4, nstart = 10)
otter.clusters <- data.frame(otter, cluster = otter.k.4$cluster)
assignments <- table(otter.clusters$species, otter.clusters$cluster)
assignments

```

***

###References

See: [Bibliographies in RStudio](http://rmarkdown.rstudio.com/authoring_bibliographies_and_citations.html)

***

Questions?  e-mail me at <a href="mailto:jcoliver@email.arizona.edu">jcoliver@email.arizona.edu</a>.