---
title: "Introduction to data visualization with ggplot"
author: "Jeff Oliver"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: 
  html_document:
    css: stylesheets/markdown-styles.css
---

An introduction to using the R statistics package and the RStudio interface for multivariate statistics.

#### Learning objectives
1. Install and use third-party packages for R
2. Use layering to add elements to a plot
3. Format plots with faceting

## Setup
### Workspace organization
First we need to setup our development environment. We need to create two folders: 'data' will store the data we will be analyzing, and 'output' will store the results of our analyses.
```{r, eval = FALSE}
dir.create(path = "data")
dir.create(path = "output")
```

With this workspace organization, we can download the data, either manually or use R to automatically download it. For this lesson we'll do the latter, saving the file in the `data` directory we just created, and name the file `gapminder.csv`:

```{r, eval = FALSE}
download.file(url = "http://tinyurl.com/qb83k3z", destfile = "data/gapminder.csv")
```

From this point on, we want to keep track of what we have done, so we will restrict our use of the console and instead use script files. Start a new script with some brief header information at the very top. We want, at the very least, to include:
1. A short description of what the script does (no more than one line of text)
2. Your name
3. A means of contacting you (e.g. your e-mail address)
4. The date, preferably in ISO format YYYY-MM-DD
```{r}
# Plot gapminder data
# Jeff Oliver
# jcoliver@email.arizona.edu
# 2017-02-23
```

### Installing additional packages
There are two steps to using additional packages in R:
1. Install the package through `install.packages()`
2. Load the package into active memory with `library()`

For this exercise, we will install the `ggplot2` package:

```{r eval = FALSE}
install.packages("ggplot2")
library("ggplot2")
```

It is important to note that for each computer you work on, the `install.packages` command need only be issued once, while the call to `library` will need to be issued for each session of R. Because of this, it is standard convention in scripts to comment out the `install.packages` command once it has been run on the machine, so our script now looks like:

```{r}
# Plot gapminder data
# Jeff Oliver
# jcoliver@email.arizona.edu
# 2017-02-23

#install.packages("ggplot2")
library("ggplot2")
```

## Now plot!

### Scatterplot
For our first plot, we will create an X-Y scatterplot to investigate a potential relationship between a country's gross domestic product (GDP) and the average life expectancy. We do so by creating a `ggplot` object, then calling `print` on that object:

```{r}
# Load data
gapminder <- read.csv(file = "data/gapminder.csv")

# Create plot object
lifeExp.plot <- ggplot(data = gapminder, aes(x = gdpPercap, y = lifeExp))

# Draw plot
print(lifeExp.plot)  
```

_What happened?_ There are no points!? Here is where functionality of ggplot is evident. The way it works is by effectively drawing layer upon layer of graphics. So we have established the plot, but we need to add one more bit of information to tell ggplot what to put in that plot area. For a scatter plot, we use `geom_point()`, literally adding this to the ggplot object with a plus sign (+):

```{r}
# Create plot object
lifeExp.plot <- ggplot(data = gapminder, aes(x = gdpPercap, y = lifeExp)) +
  geom_point()

# Draw plot
print(lifeExp.plot)  
```

It is a little difficult to see how the points are distributed, as most are clustered on the left-hand side of the graph. To spread this distribution out, we can change the scale of the x-axis so GDP is displayed on a log scale by adding `scale_x_log10`:

```{r}
# Create plot object
lifeExp.plot <- ggplot(data = gapminder, aes(x = gdpPercap, y = lifeExp)) +
  geom_point() +
  scale_x_log10()

# Draw plot
print(lifeExp.plot)  
```

One thing of interest is to include additional information in the plot, such as which continent each point comes from. We can color points by another value in our data through the `aes` parameter in the initial call to `ggplot`. So in addition to telling R which data to use for the x and y axes, we indicate which data to use for point colors:

```{r}
# Create plot object
lifeExp.plot <- ggplot(data = gapminder, aes(x = gdpPercap, y = lifeExp, color = continent)) +
  geom_point() +
  scale_x_log10()

# Draw plot
print(lifeExp.plot)  
```

At this point, we want to change the colors of the points in two ways: (1) we want to make them slightly transparent because there is considerable overlap in some part of the graph; we do this by setting the `alpha` parameter in the `geom_point` call; (2) we want to use custom colors for each continent; this is done with the `scale_color_manual` function:

```{r}
# Create plot object
lifeExp.plot <- ggplot(data = gapminder, aes(x = gdpPercap, y = lifeExp, color = continent)) +
  geom_point(alpha = 0.5) +
  scale_x_log10() +
  scale_color_manual(values = c("red", "orange", "forestgreen", "darkblue", "violet"))

# Draw plot
print(lifeExp.plot)  
```

Finally, we should make those axis labels a little nicer.

```{r}
# Create plot object
lifeExp.plot <- ggplot(data = gapminder, aes(x = gdpPercap, y = lifeExp, color = continent)) +
  geom_point(alpha = 0.5) +
  scale_x_log10() +
  scale_color_manual(values = c("red", "orange", "forestgreen", "darkblue", "violet")) +
  xlab("GDP per capita") +
  ylab("Life Expectancy")

# Draw plot
print(lifeExp.plot)
```

And if we want to save the plot to a file, we call `ggsave`, passing a filename and the plot object we want to save (the latter is optional, if we don't indicate which plot to save, `ggsave` will save the last plot that was displayed):

```{r, eval = FALSE}
# Save plot to png file
ggsave(filename = "output/gdp-lifeExp-plot.png", plot = lifeExp.plot)
```

Also note that `ggsave` will guess the type of file to save from the extension. For example, if we instead wanted to save a TIF instead of a PNG, we change the extension for the `filename` argument:

```{r, eval = FALSE}
# Save plot to tif file
ggsave(filename = "output/gdp-lifeExp-plot.tif", plot = lifeExp.plot)
```

Our final script for this scatterplot is then:

```{r, eval = FALSE}
# Plot gapminder data
# Jeff Oliver
# jcoliver@email.arizona.edu
# 2017-02-23

#install.packages("ggplot2")
library("ggplot2")

# Load data
gapminder <- read.csv(file = "data/gapminder.csv")

# Create plot object
lifeExp.plot <- ggplot(data = gapminder, aes(x = gdpPercap, y = lifeExp, color = continent)) +
  geom_point(alpha = 0.5) +
  scale_x_log10() +
  scale_color_manual(values = c("red", "orange", "forestgreen", "darkblue", "violet")) +
  xlab("GDP per capita") +
  ylab("Life Expectancy")

# Draw plot
print(lifeExp.plot)  

# Save plot to png file
ggsave(filename = "output/gdp-lifeExp-plot.png", plot = lifeExp.plot)
```

***

### Violin plot
1. Y: gdp, X: continent
2. Y: log(gdp), X: continent
3. Y: log(gdp), X: continent, color by continent
4. Add theme_bw()
5. Facet on year
(6. ggsave?)

# script.header?

```{r, eval = FALSE}
# Violin plot of GDP data
# Jeff Oliver
# jcoliver@email.arizona.edu
# 2017-02-23

rm(list = ls())

#install.packages("ggplot2")
library("ggplot2")
```

```{r}
# Load data
gapminder <- read.csv(file = "data/gapminder.csv")

gapminder <- gapminder[gapminder$continent != "Oceania", ]
  # ^^^ six, drop oceania after looking at Oceania data (only two points per year)

gdp.plot <- ggplot(data = gapminder, aes(x = continent, y = gdpPercap, fill = continent)) +
  geom_violin() +
  # ^^^ one
  scale_y_log10() +
  ylab("GDP per capita") +
  # ^^^ two
  scale_fill_manual(values = c("red", "orange", "forestgreen", "darkblue", "violet")) +
  # ^^^ three, but two-step, adding fill = continent to ggplot call as second step
   theme_bw() +
  # ^^^ four
  facet_wrap(~ year) + #nrow = 
  theme(axis.text.x = element_blank())
  # ^^^ five

gdp.plot
```

***

## Additional resources

***

<a href="index.html">Back to learn-r main page</a>
  
Questions?  e-mail me at <a href="mailto:jcoliver@email.arizona.edu">jcoliver@email.arizona.edu</a>.