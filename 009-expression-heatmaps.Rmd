---
title: "Heatmaps - the gene expression edition"
author: "Jeff Oliver"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  html_document: default
  pdf_document:
    latex_engine: xelatex
---

[INTRODUCTORY SENTENCE]

#### Learning objectives
1. one
2. two
3. three

## [DESCRIPTION OR MOTIVATION; 2-4 sentences that would be used for an announcement]

***

## Getting started

***

## [TOPIC ONE]

***

## [TOPIC TWO]

Install two packages (in console)
```{r eval = FALSE}
install.packages("ggplot2")
install.packages("tidyr")
```

Create places for data and output
```{r eval = FALSE}
dir.create("data")
dir.create("output")
```

Download data and put it in the `data` folder.
Data is at: [http://tinyurl.com/flu-expression-data](http://tinyurl.com/flu-expression-data) or [https://jcoliver.github.io/learn-r/data/GSE68849-expression.csv](https://jcoliver.github.io/learn-r/data/GSE68849-expression.csv)

Create a script that will save all our work; also, load additional packages
```{r}
# Expression heatmap
# Jeff Oliver
# jcoliver@email.arizona.edu
# 2017-09-14

library("tidyr")
library("ggplot2")
```

Read in the data
```{r}
# Expression heatmap
# Jeff Oliver
# jcoliver@email.arizona.edu
# 2017-09-14

library("tidyr")
library("ggplot2")

exp.data <- read.csv(file = "data/GSE68849-expression.csv", stringsAsFactors = FALSE)
```

Investigate data with `summary`
```{r}
summary(exp.data)
```

Transform data to long format
```{r}
# Expression heatmap
# Jeff Oliver
# jcoliver@email.arizona.edu
# 2017-09-14

library("tidyr")
library("ggplot2")

exp.data <- read.csv(file = "data/GSE68849-expression.csv", stringsAsFactors = FALSE)

exp.long <- gather(data = exp.data, 
                   key = gene, 
                   value = expression, 
                   -subject, -treatment)
```

Look at the top of the long data:
```{r}
head(exp.long)
```

Plot!
```{r}
# Expression heatmap
# Jeff Oliver
# jcoliver@email.arizona.edu
# 2017-09-14

library("tidyr")
library("ggplot2")

exp.data <- read.csv(file = "data/GSE68849-expression.csv", stringsAsFactors = FALSE)

exp.long <- gather(data = exp.data, 
                   key = gene, 
                   value = expression, 
                   -subject, -treatment)

exp.heatmap <- ggplot(data = exp.long, mapping = aes(x = subject,
                                                     y = gene,
                                                     fill = expression))
exp.heatmap
```

Add `geom_tile`
```{r}
# Expression heatmap
# Jeff Oliver
# jcoliver@email.arizona.edu
# 2017-09-14

library("tidyr")
library("ggplot2")

exp.data <- read.csv(file = "data/GSE68849-expression.csv", stringsAsFactors = FALSE)

exp.long <- gather(data = exp.data, 
                   key = gene, 
                   value = expression, 
                   -subject, -treatment)

exp.heatmap <- ggplot(data = exp.long, mapping = aes(x = subject,
                                                     y = gene,
                                                     fill = expression)) +
  geom_tile()

exp.heatmap
```

Do log transformation and graph that instead
```{r}
# Expression heatmap
# Jeff Oliver
# jcoliver@email.arizona.edu
# 2017-09-14

library("tidyr")
library("ggplot2")

exp.data <- read.csv(file = "data/GSE68849-expression.csv", stringsAsFactors = FALSE)

exp.long <- gather(data = exp.data, 
                   key = gene, 
                   value = expression, 
                   -subject, -treatment)

exp.long$log.expression <- log(exp.long$expression)

exp.heatmap <- ggplot(data = exp.long, mapping = aes(x = subject,
                                                     y = gene,
                                                     fill = log.expression)) +
  geom_tile()

exp.heatmap
```

Clean up x-axis
```{r}
# Expression heatmap
# Jeff Oliver
# jcoliver@email.arizona.edu
# 2017-09-14

library("tidyr")
library("ggplot2")

exp.data <- read.csv(file = "data/GSE68849-expression.csv", stringsAsFactors = FALSE)

exp.long <- gather(data = exp.data, 
                   key = gene, 
                   value = expression, 
                   -subject, -treatment)

exp.long$log.expression <- log(exp.long$expression)

exp.heatmap <- ggplot(data = exp.long, mapping = aes(x = subject,
                                                     y = gene,
                                                     fill = log.expression)) +
  geom_tile() +
  xlab(label = "Subject") +
  theme(axis.title.y = element_blank(),
        axis.text.x = element_text(angle = 45, vjust = 0.5))

exp.heatmap
```

Add facet to separate control from flu
Final (without saving)
```{r}
# Expression heatmap
# Jeff Oliver
# jcoliver@email.arizona.edu
# 2017-09-14

library("tidyr")
library("ggplot2")

exp.data <- read.csv(file = "data/GSE68849-expression.csv", stringsAsFactors = FALSE)

exp.long <- gather(data = exp.data, 
                   key = gene, 
                   value = expression, 
                   -subject, -treatment)

exp.long$log.expression <- log(exp.long$expression)

exp.heatmap <- ggplot(data = exp.long, mapping = aes(x = subject,
                                                     y = gene,
                                                     fill = log.expression)) +
  geom_tile() +
  xlab(label = "Subject") +
  facet_grid(~ treatment, switch = "x", scales = "free_x", space = "free_x") +
  theme(axis.title.y = element_blank(),
        axis.text.x = element_text(angle = 45, vjust = 0.5))

exp.heatmap

```


Final script:
```{r eval = FALSE}
# Expression heatmap
# Jeff Oliver
# jcoliver@email.arizona.edu
# 2017-09-14

library("tidyr")
library("ggplot2")

exp.data <- read.csv(file = "data/GSE68849-expression.csv", stringsAsFactors = FALSE)

exp.long <- gather(data = exp.data, 
                   key = gene, 
                   value = expression, 
                   -subject, -treatment)

exp.long$log.expression <- log(exp.long$expression)

exp.heatmap <- ggplot(data = exp.long, mapping = aes(x = subject,
                                                     y = gene,
                                                     fill = log.expression)) +
  geom_tile() +
  xlab(label = "Subject") +
  facet_grid(~ treatment, switch = "x", scales = "free_x", space = "free_x") +
  theme(axis.title.y = element_blank(),
        axis.text.x = element_text(angle = 45, vjust = 0.5))

ggsave(filename = "output/expression-heatmap.pdf", plot = exp.heatmap)
```

***

## Additional resources

+ [resource one](url-one)
+ [resource two](url-two)
+ A [PDF version](https://jcoliver.github.io/learn-r/009-expression-heatmaps.pdf) of this lesson

***

<a href="index.html">Back to learn-r main page</a>
  
Questions?  e-mail me at <a href="mailto:jcoliver@email.arizona.edu">jcoliver@email.arizona.edu</a>.